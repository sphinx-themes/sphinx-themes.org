<!DOCTYPE html>
<html lang="en"
      data-content_root="../../../"
      x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }"
      x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))"
      class="scroll-smooth"
      :class="{'dark': darkMode === 'dark' || (darkMode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)}"
>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="white" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="black" />
  
    <title>urllib.parse | Awesome</title>
    <meta property="og:title" content="urllib.parse | Awesome" />
    <meta name="twitter:title" content="urllib.parse | Awesome" />
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e72c8e07" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme.css?v=42baaae4" />
        <link rel="search" title="Search" href="../../../search/" />
        <link rel="index" title="Index" href="../../../genindex/" />

    <script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
  <body x-data="{ showSidebar: false, showScrollTop: false }" class="min-h-screen font-sans antialiased bg-background text-foreground" :class="{ 'overflow-hidden': showSidebar }">
    <div x-cloak x-show="showSidebar" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" @click.self="showSidebar = false"></div><div id="page" class="relative flex flex-col min-h-screen"><a href="#content" class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100">
      Skip to content
    </a><header
  class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
    <div class="hidden mr-4 md:flex">
      <a href="../../../" class="flex items-center mr-6"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Awesome</span>
      </a></div><button
      class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden"
      type="button" @click="showSidebar = true">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" aria-hidden="true"
        fill="currentColor">
        <path
          d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z" />
      </svg>
      <span class="sr-only">Toggle navigation menu</span>
    </button>
    <div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
      <div class="flex-1 w-full md:w-auto md:flex-none"><form id="searchbox"
      action="../../../search/"
      method="get"
      class="relative flex items-center group"
      @keydown.k.window.meta="$refs.search.focus()">
  <input x-ref="search"
          name="q"
          id="search-input"
          type="search"
          aria-label="Search the docs"
          placeholder="Search ..."
          class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" />
  <kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
    <span class="text-xs">⌘</span>
    K
  </kbd>
</form>
      </div>
      <nav class="flex items-center space-x-1">
        <button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'"
          class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9"
          type="button"
          aria-label="Color theme switcher">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
            class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0">
            <path
              d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
            class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100">
            <path
              d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z" />
          </svg>
        </button>
      </nav>
    </div>
  </div>
</header>

    <div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside id="left-sidebar"
  class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky"
  :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }">

    <a href="../../../" class="!justify-start text-sm md:!hidden bg-background"><span class="font-bold text-clip whitespace-nowrap">Awesome</span>
    </a>

    <div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
      <div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../kitchen-sink/">Kitchen Sink</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/admonitions/">Admonitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/api/">API documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/blocks/">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/generic/">Generic items</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/images/">Images &amp; Figures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/lists/">Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/really-long/">Really Long Page Title because we should test sidebar wrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/structure/">Structural Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/structure/#structural-elements-2">Structural Elements 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/tables/">Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/typography/">Typography</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">This is a caption</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-one/">Placeholder Page One</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-two/">Placeholder Page Two</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../really-long-title/">This is just a page with a really long title for checking how the theme handles these situations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../long-page/">Long Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sphinx-doc.org">External Link</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional &quot;hidden&quot; Pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-three/">Placeholder Page Three</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-four/">Placeholder Page Four</a></li>
<li class="toctree-l1"><a class="reference external" href="https://sphinx-themes.org">Sphinx Theme Gallery</a></li>
</ul>

</nav>
      </div>
    </div>
    <button type="button" @click="showSidebar = false"
      class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
        stroke="none" class="h-4 w-4">
        <path
          d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z" />
      </svg>
    </button>
  </aside>
        <main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs"
     class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
  <a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground"
     href="../../../">
    <span class="hidden md:inline">Awesome</span>
    <svg xmlns="http://www.w3.org/2000/svg"
         height="18"
         width="18"
         viewBox="0 96 960 960"
         aria-label="Home"
         fill="currentColor"
         stroke="none"
         class="md:hidden">
      <path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z" />
    </svg>
  </a>
  
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap"
       href="../../">Module code</a>
    
<div class="mr-1">/</div><span aria-current="page"
        class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">urllib.parse</span>
</nav>

    <div id="content" role="main">
      <h1>Source code for urllib.parse</h1><div class="highlight"><pre>
<span></span><code><span id="line-1"><span class="sd">&quot;&quot;&quot;Parse (absolute and relative) URLs.</span>
</span><span id="line-2">
</span><span id="line-3"><span class="sd">urlparse module is based upon the following RFC specifications.</span>
</span><span id="line-4">
</span><span id="line-5"><span class="sd">RFC 3986 (STD66): &quot;Uniform Resource Identifiers&quot; by T. Berners-Lee, R. Fielding</span>
</span><span id="line-6"><span class="sd">and L.  Masinter, January 2005.</span>
</span><span id="line-7">
</span><span id="line-8"><span class="sd">RFC 2732 : &quot;Format for Literal IPv6 Addresses in URL&#39;s by R.Hinden, B.Carpenter</span>
</span><span id="line-9"><span class="sd">and L.Masinter, December 1999.</span>
</span><span id="line-10">
</span><span id="line-11"><span class="sd">RFC 2396:  &quot;Uniform Resource Identifiers (URI)&quot;: Generic Syntax by T.</span>
</span><span id="line-12"><span class="sd">Berners-Lee, R. Fielding, and L. Masinter, August 1998.</span>
</span><span id="line-13">
</span><span id="line-14"><span class="sd">RFC 2368: &quot;The mailto URL scheme&quot;, by P.Hoffman , L Masinter, J. Zawinski, July 1998.</span>
</span><span id="line-15">
</span><span id="line-16"><span class="sd">RFC 1808: &quot;Relative Uniform Resource Locators&quot;, by R. Fielding, UC Irvine, June</span>
</span><span id="line-17"><span class="sd">1995.</span>
</span><span id="line-18">
</span><span id="line-19"><span class="sd">RFC 1738: &quot;Uniform Resource Locators (URL)&quot; by T. Berners-Lee, L. Masinter, M.</span>
</span><span id="line-20"><span class="sd">McCahill, December 1994</span>
</span><span id="line-21">
</span><span id="line-22"><span class="sd">RFC 3986 is considered the current standard and any future changes to</span>
</span><span id="line-23"><span class="sd">urlparse module should conform with it.  The urlparse module is</span>
</span><span id="line-24"><span class="sd">currently not entirely compliant with this RFC due to defacto</span>
</span><span id="line-25"><span class="sd">scenarios for parsing, and for backward compatibility purposes, some</span>
</span><span id="line-26"><span class="sd">parsing quirks from older RFCs are retained. The testcases in</span>
</span><span id="line-27"><span class="sd">test_urlparse.py provides a good indicator of parsing behavior.</span>
</span><span id="line-28">
</span><span id="line-29"><span class="sd">The WHATWG URL Parser spec should also be considered.  We are not compliant with</span>
</span><span id="line-30"><span class="sd">it either due to existing user code API behavior expectations (Hyrum&#39;s Law).</span>
</span><span id="line-31"><span class="sd">It serves as a useful guide when making changes.</span>
</span><span id="line-32"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-33">
</span><span id="line-34"><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="line-35"><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
</span><span id="line-36"><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="line-37"><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="line-38"><span class="kn">import</span><span class="w"> </span><span class="nn">types</span>
</span><span id="line-39"><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="line-40"><span class="kn">import</span><span class="w"> </span><span class="nn">ipaddress</span>
</span><span id="line-41">
</span><span id="line-42"><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;urlparse&quot;</span><span class="p">,</span> <span class="s2">&quot;urlunparse&quot;</span><span class="p">,</span> <span class="s2">&quot;urljoin&quot;</span><span class="p">,</span> <span class="s2">&quot;urldefrag&quot;</span><span class="p">,</span>
</span><span id="line-43">           <span class="s2">&quot;urlsplit&quot;</span><span class="p">,</span> <span class="s2">&quot;urlunsplit&quot;</span><span class="p">,</span> <span class="s2">&quot;urlencode&quot;</span><span class="p">,</span> <span class="s2">&quot;parse_qs&quot;</span><span class="p">,</span>
</span><span id="line-44">           <span class="s2">&quot;parse_qsl&quot;</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="s2">&quot;quote_plus&quot;</span><span class="p">,</span> <span class="s2">&quot;quote_from_bytes&quot;</span><span class="p">,</span>
</span><span id="line-45">           <span class="s2">&quot;unquote&quot;</span><span class="p">,</span> <span class="s2">&quot;unquote_plus&quot;</span><span class="p">,</span> <span class="s2">&quot;unquote_to_bytes&quot;</span><span class="p">,</span>
</span><span id="line-46">           <span class="s2">&quot;DefragResult&quot;</span><span class="p">,</span> <span class="s2">&quot;ParseResult&quot;</span><span class="p">,</span> <span class="s2">&quot;SplitResult&quot;</span><span class="p">,</span>
</span><span id="line-47">           <span class="s2">&quot;DefragResultBytes&quot;</span><span class="p">,</span> <span class="s2">&quot;ParseResultBytes&quot;</span><span class="p">,</span> <span class="s2">&quot;SplitResultBytes&quot;</span><span class="p">]</span>
</span><span id="line-48">
</span><span id="line-49"><span class="c1"># A classification of schemes.</span>
</span><span id="line-50"><span class="c1"># The empty string classifies URLs with no scheme specified,</span>
</span><span id="line-51"><span class="c1"># being the default value returned by “urlsplit” and “urlparse”.</span>
</span><span id="line-52">
</span><span id="line-53"><span class="n">uses_relative</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;gopher&#39;</span><span class="p">,</span> <span class="s1">&#39;nntp&#39;</span><span class="p">,</span> <span class="s1">&#39;imap&#39;</span><span class="p">,</span>
</span><span id="line-54">                 <span class="s1">&#39;wais&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;shttp&#39;</span><span class="p">,</span> <span class="s1">&#39;mms&#39;</span><span class="p">,</span>
</span><span id="line-55">                 <span class="s1">&#39;prospero&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsp&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsps&#39;</span><span class="p">,</span> <span class="s1">&#39;rtspu&#39;</span><span class="p">,</span> <span class="s1">&#39;sftp&#39;</span><span class="p">,</span>
</span><span id="line-56">                 <span class="s1">&#39;svn&#39;</span><span class="p">,</span> <span class="s1">&#39;svn+ssh&#39;</span><span class="p">,</span> <span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="s1">&#39;wss&#39;</span><span class="p">]</span>
</span><span id="line-57">
</span><span id="line-58"><span class="n">uses_netloc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;gopher&#39;</span><span class="p">,</span> <span class="s1">&#39;nntp&#39;</span><span class="p">,</span> <span class="s1">&#39;telnet&#39;</span><span class="p">,</span>
</span><span id="line-59">               <span class="s1">&#39;imap&#39;</span><span class="p">,</span> <span class="s1">&#39;wais&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;mms&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;shttp&#39;</span><span class="p">,</span>
</span><span id="line-60">               <span class="s1">&#39;snews&#39;</span><span class="p">,</span> <span class="s1">&#39;prospero&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsp&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsps&#39;</span><span class="p">,</span> <span class="s1">&#39;rtspu&#39;</span><span class="p">,</span> <span class="s1">&#39;rsync&#39;</span><span class="p">,</span>
</span><span id="line-61">               <span class="s1">&#39;svn&#39;</span><span class="p">,</span> <span class="s1">&#39;svn+ssh&#39;</span><span class="p">,</span> <span class="s1">&#39;sftp&#39;</span><span class="p">,</span> <span class="s1">&#39;nfs&#39;</span><span class="p">,</span> <span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;git+ssh&#39;</span><span class="p">,</span>
</span><span id="line-62">               <span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="s1">&#39;wss&#39;</span><span class="p">,</span> <span class="s1">&#39;itms-services&#39;</span><span class="p">]</span>
</span><span id="line-63">
</span><span id="line-64"><span class="n">uses_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span> <span class="s1">&#39;hdl&#39;</span><span class="p">,</span> <span class="s1">&#39;prospero&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;imap&#39;</span><span class="p">,</span>
</span><span id="line-65">               <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;shttp&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsp&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsps&#39;</span><span class="p">,</span> <span class="s1">&#39;rtspu&#39;</span><span class="p">,</span> <span class="s1">&#39;sip&#39;</span><span class="p">,</span>
</span><span id="line-66">               <span class="s1">&#39;sips&#39;</span><span class="p">,</span> <span class="s1">&#39;mms&#39;</span><span class="p">,</span> <span class="s1">&#39;sftp&#39;</span><span class="p">,</span> <span class="s1">&#39;tel&#39;</span><span class="p">]</span>
</span><span id="line-67">
</span><span id="line-68"><span class="c1"># These are not actually used anymore, but should stay for backwards</span>
</span><span id="line-69"><span class="c1"># compatibility.  (They are undocumented, but have a public-looking name.)</span>
</span><span id="line-70">
</span><span id="line-71"><span class="n">non_hierarchical</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gopher&#39;</span><span class="p">,</span> <span class="s1">&#39;hdl&#39;</span><span class="p">,</span> <span class="s1">&#39;mailto&#39;</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">,</span>
</span><span id="line-72">                    <span class="s1">&#39;telnet&#39;</span><span class="p">,</span> <span class="s1">&#39;wais&#39;</span><span class="p">,</span> <span class="s1">&#39;imap&#39;</span><span class="p">,</span> <span class="s1">&#39;snews&#39;</span><span class="p">,</span> <span class="s1">&#39;sip&#39;</span><span class="p">,</span> <span class="s1">&#39;sips&#39;</span><span class="p">]</span>
</span><span id="line-73">
</span><span id="line-74"><span class="n">uses_query</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;wais&#39;</span><span class="p">,</span> <span class="s1">&#39;imap&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;shttp&#39;</span><span class="p">,</span> <span class="s1">&#39;mms&#39;</span><span class="p">,</span>
</span><span id="line-75">              <span class="s1">&#39;gopher&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsp&#39;</span><span class="p">,</span> <span class="s1">&#39;rtsps&#39;</span><span class="p">,</span> <span class="s1">&#39;rtspu&#39;</span><span class="p">,</span> <span class="s1">&#39;sip&#39;</span><span class="p">,</span> <span class="s1">&#39;sips&#39;</span><span class="p">]</span>
</span><span id="line-76">
</span><span id="line-77"><span class="n">uses_fragment</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span> <span class="s1">&#39;hdl&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;gopher&#39;</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">,</span>
</span><span id="line-78">                 <span class="s1">&#39;nntp&#39;</span><span class="p">,</span> <span class="s1">&#39;wais&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;shttp&#39;</span><span class="p">,</span> <span class="s1">&#39;snews&#39;</span><span class="p">,</span>
</span><span id="line-79">                 <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;prospero&#39;</span><span class="p">]</span>
</span><span id="line-80">
</span><span id="line-81"><span class="c1"># Characters valid in scheme names</span>
</span><span id="line-82"><span class="n">scheme_chars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
</span><span id="line-83">                <span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
</span><span id="line-84">                <span class="s1">&#39;0123456789&#39;</span>
</span><span id="line-85">                <span class="s1">&#39;+-.&#39;</span><span class="p">)</span>
</span><span id="line-86">
</span><span id="line-87"><span class="c1"># Leading and trailing C0 control and space to be stripped per WHATWG spec.</span>
</span><span id="line-88"><span class="c1"># == &quot;&quot;.join([chr(i) for i in range(0, 0x20 + 1)])</span>
</span><span id="line-89"><span class="n">_WHATWG_C0_CONTROL_OR_SPACE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class="s1"> &#39;</span>
</span><span id="line-90">
</span><span id="line-91"><span class="c1"># Unsafe bytes to be removed per WHATWG spec</span>
</span><span id="line-92"><span class="n">_UNSAFE_URL_BYTES_TO_REMOVE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="line-93">
</span><span id="line-94"><span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">():</span>
</span><span id="line-95"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear internal performance caches. Undocumented; some tests want it.&quot;&quot;&quot;</span>
</span><span id="line-96">    <span class="n">urlsplit</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</span><span id="line-97">    <span class="n">_byte_quoter_factory</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</span><span id="line-98">
</span><span id="line-99"><span class="c1"># Helpers for bytes handling</span>
</span><span id="line-100"><span class="c1"># For 3.2, we deliberately require applications that</span>
</span><span id="line-101"><span class="c1"># handle improperly quoted URLs to do their own</span>
</span><span id="line-102"><span class="c1"># decoding and encoding. If valid use cases are</span>
</span><span id="line-103"><span class="c1"># presented, we may relax this by using latin-1</span>
</span><span id="line-104"><span class="c1"># decoding internally for 3.3</span>
</span><span id="line-105"><span class="n">_implicit_encoding</span> <span class="o">=</span> <span class="s1">&#39;ascii&#39;</span>
</span><span id="line-106"><span class="n">_implicit_errors</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span>
</span><span id="line-107">
</span><span id="line-108"><span class="k">def</span><span class="w"> </span><span class="nf">_noop</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="line-109">    <span class="k">return</span> <span class="n">obj</span>
</span><span id="line-110">
</span><span id="line-111"><span class="k">def</span><span class="w"> </span><span class="nf">_encode_result</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">_implicit_encoding</span><span class="p">,</span>
</span><span id="line-112">                        <span class="n">errors</span><span class="o">=</span><span class="n">_implicit_errors</span><span class="p">):</span>
</span><span id="line-113">    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-114">
</span><span id="line-115"><span class="k">def</span><span class="w"> </span><span class="nf">_decode_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">_implicit_encoding</span><span class="p">,</span>
</span><span id="line-116">                       <span class="n">errors</span><span class="o">=</span><span class="n">_implicit_errors</span><span class="p">):</span>
</span><span id="line-117">    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="line-118">
</span><span id="line-119"><span class="k">def</span><span class="w"> </span><span class="nf">_coerce_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="line-120">    <span class="c1"># Invokes decode if necessary to create str args</span>
</span><span id="line-121">    <span class="c1"># and returns the coerced inputs along with</span>
</span><span id="line-122">    <span class="c1"># an appropriate result coercion function</span>
</span><span id="line-123">    <span class="c1">#   - noop for str inputs</span>
</span><span id="line-124">    <span class="c1">#   - encoding function otherwise</span>
</span><span id="line-125">    <span class="n">str_input</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="line-126">    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="line-127">        <span class="c1"># We special-case the empty string to support the</span>
</span><span id="line-128">        <span class="c1"># &quot;scheme=&#39;&#39;&quot; default argument to some functions</span>
</span><span id="line-129">        <span class="k">if</span> <span class="n">arg</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="o">!=</span> <span class="n">str_input</span><span class="p">:</span>
</span><span id="line-130">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot mix str and non-str arguments&quot;</span><span class="p">)</span>
</span><span id="line-131">    <span class="k">if</span> <span class="n">str_input</span><span class="p">:</span>
</span><span id="line-132">        <span class="k">return</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">_noop</span><span class="p">,)</span>
</span><span id="line-133">    <span class="k">return</span> <span class="n">_decode_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">_encode_result</span><span class="p">,)</span>
</span><span id="line-134">
</span><span id="line-135"><span class="c1"># Result objects are more helpful than simple tuples</span>
</span><span id="line-136"><span class="k">class</span><span class="w"> </span><span class="nc">_ResultMixinStr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="line-137"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard approach to encoding parsed results from str to bytes&quot;&quot;&quot;</span>
</span><span id="line-138">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-139">
</span><span id="line-140">    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
</span><span id="line-141">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoded_counterpart</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span><span id="line-142">
</span><span id="line-143">
</span><span id="line-144"><span class="k">class</span><span class="w"> </span><span class="nc">_ResultMixinBytes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="line-145"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard approach to decoding parsed results from bytes to str&quot;&quot;&quot;</span>
</span><span id="line-146">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-147">
</span><span id="line-148">    <span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
</span><span id="line-149">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_counterpart</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span><span id="line-150">
</span><span id="line-151">
</span><span id="line-152"><span class="k">class</span><span class="w"> </span><span class="nc">_NetlocResultMixinBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="line-153"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shared methods for the parsed result objects containing a netloc element&quot;&quot;&quot;</span>
</span><span id="line-154">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-155">
</span><span id="line-156">    <span class="nd">@property</span>
</span><span id="line-157">    <span class="k">def</span><span class="w"> </span><span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-158">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_userinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-159">
</span><span id="line-160">    <span class="nd">@property</span>
</span><span id="line-161">    <span class="k">def</span><span class="w"> </span><span class="nf">password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-162">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_userinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="line-163">
</span><span id="line-164">    <span class="nd">@property</span>
</span><span id="line-165">    <span class="k">def</span><span class="w"> </span><span class="nf">hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-166">        <span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-167">        <span class="k">if</span> <span class="ow">not</span> <span class="n">hostname</span><span class="p">:</span>
</span><span id="line-168">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-169">        <span class="c1"># Scoped IPv6 address may have zone info, which must not be lowercased</span>
</span><span id="line-170">        <span class="c1"># like http://[fe80::822a:a8ff:fe49:470c%tESt]:1234/keys</span>
</span><span id="line-171">        <span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;%&#39;</span>
</span><span id="line-172">        <span class="n">hostname</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">zone</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
</span><span id="line-173">        <span class="k">return</span> <span class="n">hostname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">percent</span> <span class="o">+</span> <span class="n">zone</span>
</span><span id="line-174">
</span><span id="line-175">    <span class="nd">@property</span>
</span><span id="line-176">    <span class="k">def</span><span class="w"> </span><span class="nf">port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-177">        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="line-178">        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-179">            <span class="k">if</span> <span class="n">port</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">port</span><span class="o">.</span><span class="n">isascii</span><span class="p">():</span>
</span><span id="line-180">                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</span><span id="line-181">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-182">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port could not be cast to integer value as </span><span class="si">{</span><span class="n">port</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="line-183">            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">):</span>
</span><span id="line-184">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Port out of range 0-65535&quot;</span><span class="p">)</span>
</span><span id="line-185">        <span class="k">return</span> <span class="n">port</span>
</span><span id="line-186">
</span><span id="line-187">    <span class="n">__class_getitem__</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">GenericAlias</span><span class="p">)</span>
</span><span id="line-188">
</span><span id="line-189">
</span><span id="line-190"><span class="k">class</span><span class="w"> </span><span class="nc">_NetlocResultMixinStr</span><span class="p">(</span><span class="n">_NetlocResultMixinBase</span><span class="p">,</span> <span class="n">_ResultMixinStr</span><span class="p">):</span>
</span><span id="line-191">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-192">
</span><span id="line-193">    <span class="nd">@property</span>
</span><span id="line-194">    <span class="k">def</span><span class="w"> </span><span class="nf">_userinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-195">        <span class="n">netloc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="line-196">        <span class="n">userinfo</span><span class="p">,</span> <span class="n">have_info</span><span class="p">,</span> <span class="n">hostinfo</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
</span><span id="line-197">        <span class="k">if</span> <span class="n">have_info</span><span class="p">:</span>
</span><span id="line-198">            <span class="n">username</span><span class="p">,</span> <span class="n">have_password</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">userinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-199">            <span class="k">if</span> <span class="ow">not</span> <span class="n">have_password</span><span class="p">:</span>
</span><span id="line-200">                <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-201">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-202">            <span class="n">username</span> <span class="o">=</span> <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-203">        <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
</span><span id="line-204">
</span><span id="line-205">    <span class="nd">@property</span>
</span><span id="line-206">    <span class="k">def</span><span class="w"> </span><span class="nf">_hostinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-207">        <span class="n">netloc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="line-208">        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">hostinfo</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
</span><span id="line-209">        <span class="n">_</span><span class="p">,</span> <span class="n">have_open_br</span><span class="p">,</span> <span class="n">bracketed</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span><span id="line-210">        <span class="k">if</span> <span class="n">have_open_br</span><span class="p">:</span>
</span><span id="line-211">            <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">bracketed</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="line-212">            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-213">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-214">            <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-215">        <span class="k">if</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
</span><span id="line-216">            <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-217">        <span class="k">return</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">port</span>
</span><span id="line-218">
</span><span id="line-219">
</span><span id="line-220"><span class="k">class</span><span class="w"> </span><span class="nc">_NetlocResultMixinBytes</span><span class="p">(</span><span class="n">_NetlocResultMixinBase</span><span class="p">,</span> <span class="n">_ResultMixinBytes</span><span class="p">):</span>
</span><span id="line-221">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-222">
</span><span id="line-223">    <span class="nd">@property</span>
</span><span id="line-224">    <span class="k">def</span><span class="w"> </span><span class="nf">_userinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-225">        <span class="n">netloc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="line-226">        <span class="n">userinfo</span><span class="p">,</span> <span class="n">have_info</span><span class="p">,</span> <span class="n">hostinfo</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
</span><span id="line-227">        <span class="k">if</span> <span class="n">have_info</span><span class="p">:</span>
</span><span id="line-228">            <span class="n">username</span><span class="p">,</span> <span class="n">have_password</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">userinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-229">            <span class="k">if</span> <span class="ow">not</span> <span class="n">have_password</span><span class="p">:</span>
</span><span id="line-230">                <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-231">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-232">            <span class="n">username</span> <span class="o">=</span> <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-233">        <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
</span><span id="line-234">
</span><span id="line-235">    <span class="nd">@property</span>
</span><span id="line-236">    <span class="k">def</span><span class="w"> </span><span class="nf">_hostinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-237">        <span class="n">netloc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netloc</span>
</span><span id="line-238">        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">hostinfo</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
</span><span id="line-239">        <span class="n">_</span><span class="p">,</span> <span class="n">have_open_br</span><span class="p">,</span> <span class="n">bracketed</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span><span id="line-240">        <span class="k">if</span> <span class="n">have_open_br</span><span class="p">:</span>
</span><span id="line-241">            <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">bracketed</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="line-242">            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-243">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-244">            <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">hostinfo</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-245">        <span class="k">if</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
</span><span id="line-246">            <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-247">        <span class="k">return</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">port</span>
</span><span id="line-248">
</span><span id="line-249">
</span><span id="line-250"><span class="n">_DefragResultBase</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;DefragResult&#39;</span><span class="p">,</span> <span class="s1">&#39;url fragment&#39;</span><span class="p">)</span>
</span><span id="line-251"><span class="n">_SplitResultBase</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span><span id="line-252">    <span class="s1">&#39;SplitResult&#39;</span><span class="p">,</span> <span class="s1">&#39;scheme netloc path query fragment&#39;</span><span class="p">)</span>
</span><span id="line-253"><span class="n">_ParseResultBase</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span><span id="line-254">    <span class="s1">&#39;ParseResult&#39;</span><span class="p">,</span> <span class="s1">&#39;scheme netloc path params query fragment&#39;</span><span class="p">)</span>
</span><span id="line-255">
</span><span id="line-256"><span class="n">_DefragResultBase</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-257"><span class="s2">DefragResult(url, fragment)</span>
</span><span id="line-258">
</span><span id="line-259"><span class="s2">A 2-tuple that contains the url without fragment identifier and the fragment</span>
</span><span id="line-260"><span class="s2">identifier as a separate argument.</span>
</span><span id="line-261"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-262">
</span><span id="line-263"><span class="n">_DefragResultBase</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The URL with no fragment identifier.&quot;&quot;&quot;</span>
</span><span id="line-264">
</span><span id="line-265"><span class="n">_DefragResultBase</span><span class="o">.</span><span class="n">fragment</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-266"><span class="s2">Fragment identifier separated from URL, that allows indirect identification of a</span>
</span><span id="line-267"><span class="s2">secondary resource by reference to a primary resource and additional identifying</span>
</span><span id="line-268"><span class="s2">information.</span>
</span><span id="line-269"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-270">
</span><span id="line-271"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-272"><span class="s2">SplitResult(scheme, netloc, path, query, fragment)</span>
</span><span id="line-273">
</span><span id="line-274"><span class="s2">A 5-tuple that contains the different components of a URL. Similar to</span>
</span><span id="line-275"><span class="s2">ParseResult, but does not split params.</span>
</span><span id="line-276"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-277">
</span><span id="line-278"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Specifies URL scheme for the request.&quot;&quot;&quot;</span>
</span><span id="line-279">
</span><span id="line-280"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-281"><span class="s2">Network location where the request is made to.</span>
</span><span id="line-282"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-283">
</span><span id="line-284"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-285"><span class="s2">The hierarchical path, such as the path to a file to download.</span>
</span><span id="line-286"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-287">
</span><span id="line-288"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-289"><span class="s2">The query component, that contains non-hierarchical data, that along with data</span>
</span><span id="line-290"><span class="s2">in path component, identifies a resource in the scope of URI&#39;s scheme and</span>
</span><span id="line-291"><span class="s2">network location.</span>
</span><span id="line-292"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-293">
</span><span id="line-294"><span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">fragment</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-295"><span class="s2">Fragment identifier, that allows indirect identification of a secondary resource</span>
</span><span id="line-296"><span class="s2">by reference to a primary resource and additional identifying information.</span>
</span><span id="line-297"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-298">
</span><span id="line-299"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-300"><span class="s2">ParseResult(scheme, netloc, path, params, query, fragment)</span>
</span><span id="line-301">
</span><span id="line-302"><span class="s2">A 6-tuple that contains components of a parsed URL.</span>
</span><span id="line-303"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-304">
</span><span id="line-305"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="line-306"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="line-307"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="line-308"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-309"><span class="s2">Parameters for last path element used to dereference the URI in order to provide</span>
</span><span id="line-310"><span class="s2">access to perform some operation on the resource.</span>
</span><span id="line-311"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-312">
</span><span id="line-313"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="line-314"><span class="n">_ParseResultBase</span><span class="o">.</span><span class="n">fragment</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_SplitResultBase</span><span class="o">.</span><span class="n">fragment</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="line-315">
</span><span id="line-316">
</span><span id="line-317"><span class="c1"># For backwards compatibility, alias _NetlocResultMixinStr</span>
</span><span id="line-318"><span class="c1"># ResultBase is no longer part of the documented API, but it is</span>
</span><span id="line-319"><span class="c1"># retained since deprecating it isn&#39;t worth the hassle</span>
</span><span id="line-320"><span class="n">ResultBase</span> <span class="o">=</span> <span class="n">_NetlocResultMixinStr</span>
</span><span id="line-321">
</span><span id="line-322"><span class="c1"># Structured result objects for string data</span>
<div class="viewcode-block" id="DefragResult">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.DefragResult">[docs]</a>
</span><span id="line-323"><span class="k">class</span><span class="w"> </span><span class="nc">DefragResult</span><span class="p">(</span><span class="n">_DefragResultBase</span><span class="p">,</span> <span class="n">_ResultMixinStr</span><span class="p">):</span>
</span><span id="line-324">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-325">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-326">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment</span><span class="p">:</span>
</span><span id="line-327">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment</span>
</span><span id="line-328">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-329">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span></div>

</span><span id="line-330">
<div class="viewcode-block" id="SplitResult">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.SplitResult">[docs]</a>
</span><span id="line-331"><span class="k">class</span><span class="w"> </span><span class="nc">SplitResult</span><span class="p">(</span><span class="n">_SplitResultBase</span><span class="p">,</span> <span class="n">_NetlocResultMixinStr</span><span class="p">):</span>
</span><span id="line-332">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-333">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-334">        <span class="k">return</span> <span class="n">urlunsplit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

</span><span id="line-335">
<div class="viewcode-block" id="ParseResult">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.ParseResult">[docs]</a>
</span><span id="line-336"><span class="k">class</span><span class="w"> </span><span class="nc">ParseResult</span><span class="p">(</span><span class="n">_ParseResultBase</span><span class="p">,</span> <span class="n">_NetlocResultMixinStr</span><span class="p">):</span>
</span><span id="line-337">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-338">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-339">        <span class="k">return</span> <span class="n">urlunparse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

</span><span id="line-340">
</span><span id="line-341"><span class="c1"># Structured result objects for bytes data</span>
<div class="viewcode-block" id="DefragResultBytes">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.DefragResultBytes">[docs]</a>
</span><span id="line-342"><span class="k">class</span><span class="w"> </span><span class="nc">DefragResultBytes</span><span class="p">(</span><span class="n">_DefragResultBase</span><span class="p">,</span> <span class="n">_ResultMixinBytes</span><span class="p">):</span>
</span><span id="line-343">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-344">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-345">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment</span><span class="p">:</span>
</span><span id="line-346">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment</span>
</span><span id="line-347">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-348">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span></div>

</span><span id="line-349">
<div class="viewcode-block" id="SplitResultBytes">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.SplitResultBytes">[docs]</a>
</span><span id="line-350"><span class="k">class</span><span class="w"> </span><span class="nc">SplitResultBytes</span><span class="p">(</span><span class="n">_SplitResultBase</span><span class="p">,</span> <span class="n">_NetlocResultMixinBytes</span><span class="p">):</span>
</span><span id="line-351">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-352">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-353">        <span class="k">return</span> <span class="n">urlunsplit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

</span><span id="line-354">
<div class="viewcode-block" id="ParseResultBytes">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.ParseResultBytes">[docs]</a>
</span><span id="line-355"><span class="k">class</span><span class="w"> </span><span class="nc">ParseResultBytes</span><span class="p">(</span><span class="n">_ParseResultBase</span><span class="p">,</span> <span class="n">_NetlocResultMixinBytes</span><span class="p">):</span>
</span><span id="line-356">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="line-357">    <span class="k">def</span><span class="w"> </span><span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-358">        <span class="k">return</span> <span class="n">urlunparse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

</span><span id="line-359">
</span><span id="line-360"><span class="c1"># Set up the encode/decode result pairs</span>
</span><span id="line-361"><span class="k">def</span><span class="w"> </span><span class="nf">_fix_result_transcoding</span><span class="p">():</span>
</span><span id="line-362">    <span class="n">_result_pairs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="line-363">        <span class="p">(</span><span class="n">DefragResult</span><span class="p">,</span> <span class="n">DefragResultBytes</span><span class="p">),</span>
</span><span id="line-364">        <span class="p">(</span><span class="n">SplitResult</span><span class="p">,</span> <span class="n">SplitResultBytes</span><span class="p">),</span>
</span><span id="line-365">        <span class="p">(</span><span class="n">ParseResult</span><span class="p">,</span> <span class="n">ParseResultBytes</span><span class="p">),</span>
</span><span id="line-366">    <span class="p">)</span>
</span><span id="line-367">    <span class="k">for</span> <span class="n">_decoded</span><span class="p">,</span> <span class="n">_encoded</span> <span class="ow">in</span> <span class="n">_result_pairs</span><span class="p">:</span>
</span><span id="line-368">        <span class="n">_decoded</span><span class="o">.</span><span class="n">_encoded_counterpart</span> <span class="o">=</span> <span class="n">_encoded</span>
</span><span id="line-369">        <span class="n">_encoded</span><span class="o">.</span><span class="n">_decoded_counterpart</span> <span class="o">=</span> <span class="n">_decoded</span>
</span><span id="line-370">
</span><span id="line-371"><span class="n">_fix_result_transcoding</span><span class="p">()</span>
</span><span id="line-372"><span class="k">del</span> <span class="n">_fix_result_transcoding</span>
</span><span id="line-373">
<div class="viewcode-block" id="urlparse">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urlparse">[docs]</a>
</span><span id="line-374"><span class="k">def</span><span class="w"> </span><span class="nf">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="line-375"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a URL into 6 components:</span>
</span><span id="line-376"><span class="sd">    &lt;scheme&gt;://&lt;netloc&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;fragment&gt;</span>
</span><span id="line-377">
</span><span id="line-378"><span class="sd">    The result is a named 6-tuple with fields corresponding to the</span>
</span><span id="line-379"><span class="sd">    above. It is either a ParseResult or ParseResultBytes object,</span>
</span><span id="line-380"><span class="sd">    depending on the type of the url parameter.</span>
</span><span id="line-381">
</span><span id="line-382"><span class="sd">    The username, password, hostname, and port sub-components of netloc</span>
</span><span id="line-383"><span class="sd">    can also be accessed as attributes of the returned object.</span>
</span><span id="line-384">
</span><span id="line-385"><span class="sd">    The scheme argument provides the default value of the scheme</span>
</span><span id="line-386"><span class="sd">    component when no scheme is found in url.</span>
</span><span id="line-387">
</span><span id="line-388"><span class="sd">    If allow_fragments is False, no attempt is made to separate the</span>
</span><span id="line-389"><span class="sd">    fragment component from the previous component, which can be either</span>
</span><span id="line-390"><span class="sd">    path or query.</span>
</span><span id="line-391">
</span><span id="line-392"><span class="sd">    Note that % escapes are not expanded.</span>
</span><span id="line-393"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-394">    <span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="n">_coerce_args</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="p">)</span>
</span><span id="line-395">    <span class="n">splitresult</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="p">)</span>
</span><span id="line-396">    <span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span> <span class="o">=</span> <span class="n">splitresult</span>
</span><span id="line-397">    <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">uses_params</span> <span class="ow">and</span> <span class="s1">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-398">        <span class="n">url</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">_splitparams</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-399">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-400">        <span class="n">params</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-401">    <span class="n">result</span> <span class="o">=</span> <span class="n">ParseResult</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)</span>
</span><span id="line-402">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

</span><span id="line-403">
</span><span id="line-404"><span class="k">def</span><span class="w"> </span><span class="nf">_splitparams</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-405">    <span class="k">if</span> <span class="s1">&#39;/&#39;</span>  <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-406">        <span class="n">i</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="line-407">        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="line-408">            <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-409">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-410">        <span class="n">i</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span><span id="line-411">    <span class="k">return</span> <span class="n">url</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">url</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="line-412">
</span><span id="line-413"><span class="k">def</span><span class="w"> </span><span class="nf">_splitnetloc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="line-414">    <span class="n">delim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>   <span class="c1"># position of end of domain part of url, default is end</span>
</span><span id="line-415">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39;/?#&#39;</span><span class="p">:</span>    <span class="c1"># look for delimiters; the order is NOT important</span>
</span><span id="line-416">        <span class="n">wdelim</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>        <span class="c1"># find first of this delim</span>
</span><span id="line-417">        <span class="k">if</span> <span class="n">wdelim</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>                    <span class="c1"># if found</span>
</span><span id="line-418">            <span class="n">delim</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">wdelim</span><span class="p">)</span>     <span class="c1"># use earliest delim position</span>
</span><span id="line-419">    <span class="k">return</span> <span class="n">url</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">delim</span><span class="p">],</span> <span class="n">url</span><span class="p">[</span><span class="n">delim</span><span class="p">:]</span>   <span class="c1"># return (domain, rest)</span>
</span><span id="line-420">
</span><span id="line-421"><span class="k">def</span><span class="w"> </span><span class="nf">_checknetloc</span><span class="p">(</span><span class="n">netloc</span><span class="p">):</span>
</span><span id="line-422">    <span class="k">if</span> <span class="ow">not</span> <span class="n">netloc</span> <span class="ow">or</span> <span class="n">netloc</span><span class="o">.</span><span class="n">isascii</span><span class="p">():</span>
</span><span id="line-423">        <span class="k">return</span>
</span><span id="line-424">    <span class="c1"># looking for characters like \u2100 that expand to &#39;a/c&#39;</span>
</span><span id="line-425">    <span class="c1"># IDNA uses NFKC equivalence, so normalize for this check</span>
</span><span id="line-426">    <span class="kn">import</span><span class="w"> </span><span class="nn">unicodedata</span>
</span><span id="line-427">    <span class="n">n</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>   <span class="c1"># ignore characters already included</span>
</span><span id="line-428">    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>        <span class="c1"># but not the surrounding text</span>
</span><span id="line-429">    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="line-430">    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="line-431">    <span class="n">netloc2</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKC&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="line-432">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">netloc2</span><span class="p">:</span>
</span><span id="line-433">        <span class="k">return</span>
</span><span id="line-434">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39;/?#@:&#39;</span><span class="p">:</span>
</span><span id="line-435">        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">netloc2</span><span class="p">:</span>
</span><span id="line-436">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;netloc &#39;&quot;</span> <span class="o">+</span> <span class="n">netloc</span> <span class="o">+</span> <span class="s2">&quot;&#39; contains invalid &quot;</span> <span class="o">+</span>
</span><span id="line-437">                             <span class="s2">&quot;characters under NFKC normalization&quot;</span><span class="p">)</span>
</span><span id="line-438">
</span><span id="line-439"><span class="k">def</span><span class="w"> </span><span class="nf">_check_bracketed_netloc</span><span class="p">(</span><span class="n">netloc</span><span class="p">):</span>
</span><span id="line-440">    <span class="c1"># Note that this function must mirror the splitting</span>
</span><span id="line-441">    <span class="c1"># done in NetlocResultMixins._hostinfo().</span>
</span><span id="line-442">    <span class="n">hostname_and_port</span> <span class="o">=</span> <span class="n">netloc</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="line-443">    <span class="n">before_bracket</span><span class="p">,</span> <span class="n">have_open_br</span><span class="p">,</span> <span class="n">bracketed</span> <span class="o">=</span> <span class="n">hostname_and_port</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span><span id="line-444">    <span class="k">if</span> <span class="n">have_open_br</span><span class="p">:</span>
</span><span id="line-445">        <span class="c1"># No data is allowed before a bracket.</span>
</span><span id="line-446">        <span class="k">if</span> <span class="n">before_bracket</span><span class="p">:</span>
</span><span id="line-447">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid IPv6 URL&quot;</span><span class="p">)</span>
</span><span id="line-448">        <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">bracketed</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="line-449">        <span class="c1"># No data is allowed after the bracket but before the port delimiter.</span>
</span><span id="line-450">        <span class="k">if</span> <span class="n">port</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">port</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
</span><span id="line-451">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid IPv6 URL&quot;</span><span class="p">)</span>
</span><span id="line-452">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-453">        <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">hostname_and_port</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-454">    <span class="n">_check_bracketed_host</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
</span><span id="line-455">
</span><span id="line-456"><span class="c1"># Valid bracketed hosts are defined in</span>
</span><span id="line-457"><span class="c1"># https://www.rfc-editor.org/rfc/rfc3986#page-49 and https://url.spec.whatwg.org/</span>
</span><span id="line-458"><span class="k">def</span><span class="w"> </span><span class="nf">_check_bracketed_host</span><span class="p">(</span><span class="n">hostname</span><span class="p">):</span>
</span><span id="line-459">    <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">):</span>
</span><span id="line-460">        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\Av[a-fA-F0-9]+\..+\Z&quot;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span>
</span><span id="line-461">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IPvFuture address is invalid&quot;</span><span class="p">)</span>
</span><span id="line-462">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-463">        <span class="n">ip</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span> <span class="c1"># Throws Value Error if not IPv6 or IPv4</span>
</span><span id="line-464">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">):</span>
</span><span id="line-465">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An IPv4 address cannot be in brackets&quot;</span><span class="p">)</span>
</span><span id="line-466">
</span><span id="line-467"><span class="c1"># typed=True avoids BytesWarnings being emitted during cache key</span>
</span><span id="line-468"><span class="c1"># comparison since this API supports both bytes and str input.</span>
<div class="viewcode-block" id="urlsplit">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urlsplit">[docs]</a>
</span><span id="line-469"><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">typed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-470"><span class="k">def</span><span class="w"> </span><span class="nf">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="line-471"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a URL into 5 components:</span>
</span><span id="line-472"><span class="sd">    &lt;scheme&gt;://&lt;netloc&gt;/&lt;path&gt;?&lt;query&gt;#&lt;fragment&gt;</span>
</span><span id="line-473">
</span><span id="line-474"><span class="sd">    The result is a named 5-tuple with fields corresponding to the</span>
</span><span id="line-475"><span class="sd">    above. It is either a SplitResult or SplitResultBytes object,</span>
</span><span id="line-476"><span class="sd">    depending on the type of the url parameter.</span>
</span><span id="line-477">
</span><span id="line-478"><span class="sd">    The username, password, hostname, and port sub-components of netloc</span>
</span><span id="line-479"><span class="sd">    can also be accessed as attributes of the returned object.</span>
</span><span id="line-480">
</span><span id="line-481"><span class="sd">    The scheme argument provides the default value of the scheme</span>
</span><span id="line-482"><span class="sd">    component when no scheme is found in url.</span>
</span><span id="line-483">
</span><span id="line-484"><span class="sd">    If allow_fragments is False, no attempt is made to separate the</span>
</span><span id="line-485"><span class="sd">    fragment component from the previous component, which can be either</span>
</span><span id="line-486"><span class="sd">    path or query.</span>
</span><span id="line-487">
</span><span id="line-488"><span class="sd">    Note that % escapes are not expanded.</span>
</span><span id="line-489"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-490">
</span><span id="line-491">    <span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="n">_coerce_args</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">scheme</span><span class="p">)</span>
</span><span id="line-492">    <span class="c1"># Only lstrip url as some applications rely on preserving trailing space.</span>
</span><span id="line-493">    <span class="c1"># (https://url.spec.whatwg.org/#concept-basic-url-parser would strip both)</span>
</span><span id="line-494">    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">_WHATWG_C0_CONTROL_OR_SPACE</span><span class="p">)</span>
</span><span id="line-495">    <span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">_WHATWG_C0_CONTROL_OR_SPACE</span><span class="p">)</span>
</span><span id="line-496">
</span><span id="line-497">    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_UNSAFE_URL_BYTES_TO_REMOVE</span><span class="p">:</span>
</span><span id="line-498">        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="line-499">        <span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="line-500">
</span><span id="line-501">    <span class="n">allow_fragments</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">allow_fragments</span><span class="p">)</span>
</span><span id="line-502">    <span class="n">netloc</span> <span class="o">=</span> <span class="n">query</span> <span class="o">=</span> <span class="n">fragment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-503">    <span class="n">i</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-504">    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isascii</span><span class="p">()</span> <span class="ow">and</span> <span class="n">url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
</span><span id="line-505">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">url</span><span class="p">[:</span><span class="n">i</span><span class="p">]:</span>
</span><span id="line-506">            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scheme_chars</span><span class="p">:</span>
</span><span id="line-507">                <span class="k">break</span>
</span><span id="line-508">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-509">            <span class="n">scheme</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">url</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="line-510">    <span class="k">if</span> <span class="n">url</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;//&#39;</span><span class="p">:</span>
</span><span id="line-511">        <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">_splitnetloc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-512">        <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">netloc</span> <span class="ow">and</span> <span class="s1">&#39;]&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">netloc</span><span class="p">)</span> <span class="ow">or</span>
</span><span id="line-513">                <span class="p">(</span><span class="s1">&#39;]&#39;</span> <span class="ow">in</span> <span class="n">netloc</span> <span class="ow">and</span> <span class="s1">&#39;[&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">netloc</span><span class="p">)):</span>
</span><span id="line-514">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid IPv6 URL&quot;</span><span class="p">)</span>
</span><span id="line-515">        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">netloc</span> <span class="ow">and</span> <span class="s1">&#39;]&#39;</span> <span class="ow">in</span> <span class="n">netloc</span><span class="p">:</span>
</span><span id="line-516">            <span class="n">_check_bracketed_netloc</span><span class="p">(</span><span class="n">netloc</span><span class="p">)</span>
</span><span id="line-517">    <span class="k">if</span> <span class="n">allow_fragments</span> <span class="ow">and</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-518">        <span class="n">url</span><span class="p">,</span> <span class="n">fragment</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="line-519">    <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-520">        <span class="n">url</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="line-521">    <span class="n">_checknetloc</span><span class="p">(</span><span class="n">netloc</span><span class="p">)</span>
</span><span id="line-522">    <span class="n">v</span> <span class="o">=</span> <span class="n">SplitResult</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)</span>
</span><span id="line-523">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

</span><span id="line-524">
<div class="viewcode-block" id="urlunparse">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urlunparse">[docs]</a>
</span><span id="line-525"><span class="k">def</span><span class="w"> </span><span class="nf">urlunparse</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
</span><span id="line-526"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Put a parsed URL back together again.  This may result in a</span>
</span><span id="line-527"><span class="sd">    slightly different, but equivalent URL, if the URL that was parsed</span>
</span><span id="line-528"><span class="sd">    originally had redundant delimiters, e.g. a ? with an empty query</span>
</span><span id="line-529"><span class="sd">    (the draft states that these are equivalent).&quot;&quot;&quot;</span>
</span><span id="line-530">    <span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="line-531">                                                  <span class="n">_coerce_args</span><span class="p">(</span><span class="o">*</span><span class="n">components</span><span class="p">))</span>
</span><span id="line-532">    <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
</span><span id="line-533">        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span id="line-534">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">urlunsplit</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)))</span></div>

</span><span id="line-535">
<div class="viewcode-block" id="urlunsplit">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urlunsplit">[docs]</a>
</span><span id="line-536"><span class="k">def</span><span class="w"> </span><span class="nf">urlunsplit</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
</span><span id="line-537"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the elements of a tuple as returned by urlsplit() into a</span>
</span><span id="line-538"><span class="sd">    complete URL as a string. The data argument can be any five-item iterable.</span>
</span><span id="line-539"><span class="sd">    This may result in a slightly different, but equivalent URL, if the URL that</span>
</span><span id="line-540"><span class="sd">    was parsed originally had unnecessary delimiters (for example, a ? with an</span>
</span><span id="line-541"><span class="sd">    empty query; the RFC states that these are equivalent).&quot;&quot;&quot;</span>
</span><span id="line-542">    <span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="line-543">                                          <span class="n">_coerce_args</span><span class="p">(</span><span class="o">*</span><span class="n">components</span><span class="p">))</span>
</span><span id="line-544">    <span class="k">if</span> <span class="n">netloc</span> <span class="ow">or</span> <span class="p">(</span><span class="n">scheme</span> <span class="ow">and</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">uses_netloc</span> <span class="ow">and</span> <span class="n">url</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;//&#39;</span><span class="p">):</span>
</span><span id="line-545">        <span class="k">if</span> <span class="n">url</span> <span class="ow">and</span> <span class="n">url</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="line-546">        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">netloc</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="line-547">    <span class="k">if</span> <span class="n">scheme</span><span class="p">:</span>
</span><span id="line-548">        <span class="n">url</span> <span class="o">=</span> <span class="n">scheme</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">url</span>
</span><span id="line-549">    <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
</span><span id="line-550">        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">query</span>
</span><span id="line-551">    <span class="k">if</span> <span class="n">fragment</span><span class="p">:</span>
</span><span id="line-552">        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">fragment</span>
</span><span id="line-553">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

</span><span id="line-554">
<div class="viewcode-block" id="urljoin">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urljoin">[docs]</a>
</span><span id="line-555"><span class="k">def</span><span class="w"> </span><span class="nf">urljoin</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="line-556"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Join a base URL and a possibly relative URL to form an absolute</span>
</span><span id="line-557"><span class="sd">    interpretation of the latter.&quot;&quot;&quot;</span>
</span><span id="line-558">    <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
</span><span id="line-559">        <span class="k">return</span> <span class="n">url</span>
</span><span id="line-560">    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-561">        <span class="k">return</span> <span class="n">base</span>
</span><span id="line-562">
</span><span id="line-563">    <span class="n">base</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="n">_coerce_args</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span id="line-564">    <span class="n">bscheme</span><span class="p">,</span> <span class="n">bnetloc</span><span class="p">,</span> <span class="n">bpath</span><span class="p">,</span> <span class="n">bparams</span><span class="p">,</span> <span class="n">bquery</span><span class="p">,</span> <span class="n">bfragment</span> <span class="o">=</span> \
</span><span id="line-565">            <span class="n">urlparse</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="p">)</span>
</span><span id="line-566">    <span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span> <span class="o">=</span> \
</span><span id="line-567">            <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">bscheme</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="p">)</span>
</span><span id="line-568">
</span><span id="line-569">    <span class="k">if</span> <span class="n">scheme</span> <span class="o">!=</span> <span class="n">bscheme</span> <span class="ow">or</span> <span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uses_relative</span><span class="p">:</span>
</span><span id="line-570">        <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-571">    <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">uses_netloc</span><span class="p">:</span>
</span><span id="line-572">        <span class="k">if</span> <span class="n">netloc</span><span class="p">:</span>
</span><span id="line-573">            <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
</span><span id="line-574">                                              <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)))</span>
</span><span id="line-575">        <span class="n">netloc</span> <span class="o">=</span> <span class="n">bnetloc</span>
</span><span id="line-576">
</span><span id="line-577">    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
</span><span id="line-578">        <span class="n">path</span> <span class="o">=</span> <span class="n">bpath</span>
</span><span id="line-579">        <span class="n">params</span> <span class="o">=</span> <span class="n">bparams</span>
</span><span id="line-580">        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="p">:</span>
</span><span id="line-581">            <span class="n">query</span> <span class="o">=</span> <span class="n">bquery</span>
</span><span id="line-582">        <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
</span><span id="line-583">                                          <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)))</span>
</span><span id="line-584">
</span><span id="line-585">    <span class="n">base_parts</span> <span class="o">=</span> <span class="n">bpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="line-586">    <span class="k">if</span> <span class="n">base_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="line-587">        <span class="c1"># the last item is not a directory, so will not be taken into account</span>
</span><span id="line-588">        <span class="c1"># in resolving the relative path</span>
</span><span id="line-589">        <span class="k">del</span> <span class="n">base_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="line-590">
</span><span id="line-591">    <span class="c1"># for rfc3986, ignore all base path should the first character be root.</span>
</span><span id="line-592">    <span class="k">if</span> <span class="n">path</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="line-593">        <span class="n">segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="line-594">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-595">        <span class="n">segments</span> <span class="o">=</span> <span class="n">base_parts</span> <span class="o">+</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="line-596">        <span class="c1"># filter out elements that would cause redundant slashes on re-joining</span>
</span><span id="line-597">        <span class="c1"># the resolved_path</span>
</span><span id="line-598">        <span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="line-599">
</span><span id="line-600">    <span class="n">resolved_path</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-601">
</span><span id="line-602">    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
</span><span id="line-603">        <span class="k">if</span> <span class="n">seg</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
</span><span id="line-604">            <span class="k">try</span><span class="p">:</span>
</span><span id="line-605">                <span class="n">resolved_path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="line-606">            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="line-607">                <span class="c1"># ignore any .. segments that would otherwise cause an IndexError</span>
</span><span id="line-608">                <span class="c1"># when popped from resolved_path if resolving for rfc3986</span>
</span><span id="line-609">                <span class="k">pass</span>
</span><span id="line-610">        <span class="k">elif</span> <span class="n">seg</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
</span><span id="line-611">            <span class="k">continue</span>
</span><span id="line-612">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-613">            <span class="n">resolved_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</span><span id="line-614">
</span><span id="line-615">    <span class="k">if</span> <span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">):</span>
</span><span id="line-616">        <span class="c1"># do some post-processing here. if the last segment was a relative dir,</span>
</span><span id="line-617">        <span class="c1"># then we need to append the trailing &#39;/&#39;</span>
</span><span id="line-618">        <span class="n">resolved_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="line-619">
</span><span id="line-620">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="line-621">        <span class="n">resolved_path</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)))</span></div>

</span><span id="line-622">
</span><span id="line-623">
<div class="viewcode-block" id="urldefrag">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urldefrag">[docs]</a>
</span><span id="line-624"><span class="k">def</span><span class="w"> </span><span class="nf">urldefrag</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-625"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes any existing fragment from URL.</span>
</span><span id="line-626">
</span><span id="line-627"><span class="sd">    Returns a tuple of the defragmented URL and the fragment.  If</span>
</span><span id="line-628"><span class="sd">    the URL contained no fragments, the second element is the</span>
</span><span id="line-629"><span class="sd">    empty string.</span>
</span><span id="line-630"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-631">    <span class="n">url</span><span class="p">,</span> <span class="n">_coerce_result</span> <span class="o">=</span> <span class="n">_coerce_args</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-632">    <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
</span><span id="line-633">        <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">frag</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-634">        <span class="n">defrag</span> <span class="o">=</span> <span class="n">urlunparse</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="line-635">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-636">        <span class="n">frag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-637">        <span class="n">defrag</span> <span class="o">=</span> <span class="n">url</span>
</span><span id="line-638">    <span class="k">return</span> <span class="n">_coerce_result</span><span class="p">(</span><span class="n">DefragResult</span><span class="p">(</span><span class="n">defrag</span><span class="p">,</span> <span class="n">frag</span><span class="p">))</span></div>

</span><span id="line-639">
</span><span id="line-640"><span class="n">_hexdig</span> <span class="o">=</span> <span class="s1">&#39;0123456789ABCDEFabcdef&#39;</span>
</span><span id="line-641"><span class="n">_hextobyte</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-642">
<div class="viewcode-block" id="unquote_to_bytes">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.unquote_to_bytes">[docs]</a>
</span><span id="line-643"><span class="k">def</span><span class="w"> </span><span class="nf">unquote_to_bytes</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
</span><span id="line-644"><span class="w">    </span><span class="sd">&quot;&quot;&quot;unquote_to_bytes(&#39;abc%20def&#39;) -&gt; b&#39;abc def&#39;.&quot;&quot;&quot;</span>
</span><span id="line-645">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">_unquote_impl</span><span class="p">(</span><span class="n">string</span><span class="p">))</span></div>

</span><span id="line-646">
</span><span id="line-647"><span class="k">def</span><span class="w"> </span><span class="nf">_unquote_impl</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">bytearray</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">bytearray</span><span class="p">:</span>
</span><span id="line-648">    <span class="c1"># Note: strings are encoded as UTF-8. This is only an issue if it contains</span>
</span><span id="line-649">    <span class="c1"># unescaped non-ASCII characters, which URIs should not.</span>
</span><span id="line-650">    <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="p">:</span>
</span><span id="line-651">        <span class="c1"># Is it a string-like object?</span>
</span><span id="line-652">        <span class="n">string</span><span class="o">.</span><span class="n">split</span>
</span><span id="line-653">        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="line-654">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-655">        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="line-656">    <span class="n">bits</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="line-657">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="line-658">        <span class="k">return</span> <span class="n">string</span>
</span><span id="line-659">    <span class="n">res</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="line-660">    <span class="n">append</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">extend</span>
</span><span id="line-661">    <span class="c1"># Delay the initialization of the table to not waste memory</span>
</span><span id="line-662">    <span class="c1"># if the function is never called</span>
</span><span id="line-663">    <span class="k">global</span> <span class="n">_hextobyte</span>
</span><span id="line-664">    <span class="k">if</span> <span class="n">_hextobyte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-665">        <span class="n">_hextobyte</span> <span class="o">=</span> <span class="p">{(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">():</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</span><span id="line-666">                      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">_hexdig</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_hexdig</span><span class="p">}</span>
</span><span id="line-667">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="line-668">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-669">            <span class="n">append</span><span class="p">(</span><span class="n">_hextobyte</span><span class="p">[</span><span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span>
</span><span id="line-670">            <span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="line-671">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-672">            <span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="line-673">            <span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="line-674">    <span class="k">return</span> <span class="n">res</span>
</span><span id="line-675">
</span><span id="line-676"><span class="n">_asciire</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;([</span><span class="se">\x00</span><span class="s1">-</span><span class="se">\x7f</span><span class="s1">]+)&#39;</span><span class="p">)</span>
</span><span id="line-677">
</span><span id="line-678"><span class="k">def</span><span class="w"> </span><span class="nf">_generate_unquoted_parts</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
</span><span id="line-679">    <span class="n">previous_match_end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="line-680">    <span class="k">for</span> <span class="n">ascii_match</span> <span class="ow">in</span> <span class="n">_asciire</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
</span><span id="line-681">        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">ascii_match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span id="line-682">        <span class="k">yield</span> <span class="n">string</span><span class="p">[</span><span class="n">previous_match_end</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>  <span class="c1"># Non-ASCII</span>
</span><span id="line-683">        <span class="c1"># The ascii_match[1] group == string[start:end].</span>
</span><span id="line-684">        <span class="k">yield</span> <span class="n">_unquote_impl</span><span class="p">(</span><span class="n">ascii_match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-685">        <span class="n">previous_match_end</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="line-686">    <span class="k">yield</span> <span class="n">string</span><span class="p">[</span><span class="n">previous_match_end</span><span class="p">:]</span>  <span class="c1"># Non-ASCII tail</span>
</span><span id="line-687">
<div class="viewcode-block" id="unquote">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.unquote">[docs]</a>
</span><span id="line-688"><span class="k">def</span><span class="w"> </span><span class="nf">unquote</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">):</span>
</span><span id="line-689"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace %xx escapes by their single-character equivalent. The optional</span>
</span><span id="line-690"><span class="sd">    encoding and errors parameters specify how to decode percent-encoded</span>
</span><span id="line-691"><span class="sd">    sequences into Unicode characters, as accepted by the bytes.decode()</span>
</span><span id="line-692"><span class="sd">    method.</span>
</span><span id="line-693"><span class="sd">    By default, percent-encoded sequences are decoded with UTF-8, and invalid</span>
</span><span id="line-694"><span class="sd">    sequences are replaced by a placeholder character.</span>
</span><span id="line-695">
</span><span id="line-696"><span class="sd">    unquote(&#39;abc%20def&#39;) -&gt; &#39;abc def&#39;.</span>
</span><span id="line-697"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-698">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-699">        <span class="k">return</span> <span class="n">_unquote_impl</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-700">    <span class="k">if</span> <span class="s1">&#39;%&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span id="line-701">        <span class="c1"># Is it a string-like object?</span>
</span><span id="line-702">        <span class="n">string</span><span class="o">.</span><span class="n">split</span>
</span><span id="line-703">        <span class="k">return</span> <span class="n">string</span>
</span><span id="line-704">    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-705">        <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="line-706">    <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-707">        <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span>
</span><span id="line-708">    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_generate_unquoted_parts</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">))</span></div>

</span><span id="line-709">
</span><span id="line-710">
<div class="viewcode-block" id="parse_qs">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.parse_qs">[docs]</a>
</span><span id="line-711"><span class="k">def</span><span class="w"> </span><span class="nf">parse_qs</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="line-712">             <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">max_num_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
</span><span id="line-713"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a query given as a string argument.</span>
</span><span id="line-714">
</span><span id="line-715"><span class="sd">        Arguments:</span>
</span><span id="line-716">
</span><span id="line-717"><span class="sd">        qs: percent-encoded query string to be parsed</span>
</span><span id="line-718">
</span><span id="line-719"><span class="sd">        keep_blank_values: flag indicating whether blank values in</span>
</span><span id="line-720"><span class="sd">            percent-encoded queries should be treated as blank strings.</span>
</span><span id="line-721"><span class="sd">            A true value indicates that blanks should be retained as</span>
</span><span id="line-722"><span class="sd">            blank strings.  The default false value indicates that</span>
</span><span id="line-723"><span class="sd">            blank values are to be ignored and treated as if they were</span>
</span><span id="line-724"><span class="sd">            not included.</span>
</span><span id="line-725">
</span><span id="line-726"><span class="sd">        strict_parsing: flag indicating what to do with parsing errors.</span>
</span><span id="line-727"><span class="sd">            If false (the default), errors are silently ignored.</span>
</span><span id="line-728"><span class="sd">            If true, errors raise a ValueError exception.</span>
</span><span id="line-729">
</span><span id="line-730"><span class="sd">        encoding and errors: specify how to decode percent-encoded sequences</span>
</span><span id="line-731"><span class="sd">            into Unicode characters, as accepted by the bytes.decode() method.</span>
</span><span id="line-732">
</span><span id="line-733"><span class="sd">        max_num_fields: int. If set, then throws a ValueError if there</span>
</span><span id="line-734"><span class="sd">            are more than n fields read by parse_qsl().</span>
</span><span id="line-735">
</span><span id="line-736"><span class="sd">        separator: str. The symbol to use for separating the query arguments.</span>
</span><span id="line-737"><span class="sd">            Defaults to &amp;.</span>
</span><span id="line-738">
</span><span id="line-739"><span class="sd">        Returns a dictionary.</span>
</span><span id="line-740"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-741">    <span class="n">parsed_result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-742">    <span class="n">pairs</span> <span class="o">=</span> <span class="n">parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">,</span>
</span><span id="line-743">                      <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
</span><span id="line-744">                      <span class="n">max_num_fields</span><span class="o">=</span><span class="n">max_num_fields</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)</span>
</span><span id="line-745">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
</span><span id="line-746">        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parsed_result</span><span class="p">:</span>
</span><span id="line-747">            <span class="n">parsed_result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="line-748">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-749">            <span class="n">parsed_result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
</span><span id="line-750">    <span class="k">return</span> <span class="n">parsed_result</span></div>

</span><span id="line-751">
</span><span id="line-752">
<div class="viewcode-block" id="parse_qsl">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.parse_qsl">[docs]</a>
</span><span id="line-753"><span class="k">def</span><span class="w"> </span><span class="nf">parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="line-754">              <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">max_num_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
</span><span id="line-755"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a query given as a string argument.</span>
</span><span id="line-756">
</span><span id="line-757"><span class="sd">        Arguments:</span>
</span><span id="line-758">
</span><span id="line-759"><span class="sd">        qs: percent-encoded query string to be parsed</span>
</span><span id="line-760">
</span><span id="line-761"><span class="sd">        keep_blank_values: flag indicating whether blank values in</span>
</span><span id="line-762"><span class="sd">            percent-encoded queries should be treated as blank strings.</span>
</span><span id="line-763"><span class="sd">            A true value indicates that blanks should be retained as blank</span>
</span><span id="line-764"><span class="sd">            strings.  The default false value indicates that blank values</span>
</span><span id="line-765"><span class="sd">            are to be ignored and treated as if they were  not included.</span>
</span><span id="line-766">
</span><span id="line-767"><span class="sd">        strict_parsing: flag indicating what to do with parsing errors. If</span>
</span><span id="line-768"><span class="sd">            false (the default), errors are silently ignored. If true,</span>
</span><span id="line-769"><span class="sd">            errors raise a ValueError exception.</span>
</span><span id="line-770">
</span><span id="line-771"><span class="sd">        encoding and errors: specify how to decode percent-encoded sequences</span>
</span><span id="line-772"><span class="sd">            into Unicode characters, as accepted by the bytes.decode() method.</span>
</span><span id="line-773">
</span><span id="line-774"><span class="sd">        max_num_fields: int. If set, then throws a ValueError</span>
</span><span id="line-775"><span class="sd">            if there are more than n fields read by parse_qsl().</span>
</span><span id="line-776">
</span><span id="line-777"><span class="sd">        separator: str. The symbol to use for separating the query arguments.</span>
</span><span id="line-778"><span class="sd">            Defaults to &amp;.</span>
</span><span id="line-779">
</span><span id="line-780"><span class="sd">        Returns a list, as G-d intended.</span>
</span><span id="line-781"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-782">
</span><span id="line-783">    <span class="k">if</span> <span class="ow">not</span> <span class="n">separator</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="line-784">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Separator must be of type string or bytes.&quot;</span><span class="p">)</span>
</span><span id="line-785">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-786">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-787">            <span class="n">separator</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
</span><span id="line-788">        <span class="n">eq</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>
</span><span id="line-789">        <span class="k">def</span><span class="w"> </span><span class="nf">_unquote</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="line-790">            <span class="k">return</span> <span class="n">unquote_plus</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
</span><span id="line-791">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-792">        <span class="k">if</span> <span class="ow">not</span> <span class="n">qs</span><span class="p">:</span>
</span><span id="line-793">            <span class="k">return</span> <span class="p">[]</span>
</span><span id="line-794">        <span class="c1"># Use memoryview() to reject integers and iterables,</span>
</span><span id="line-795">        <span class="c1"># acceptable by the bytes constructor.</span>
</span><span id="line-796">        <span class="n">qs</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">qs</span><span class="p">))</span>
</span><span id="line-797">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-798">            <span class="n">separator</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
</span><span id="line-799">        <span class="n">eq</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;=&#39;</span>
</span><span id="line-800">        <span class="k">def</span><span class="w"> </span><span class="nf">_unquote</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="line-801">            <span class="k">return</span> <span class="n">unquote_to_bytes</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</span><span id="line-802">
</span><span id="line-803">    <span class="k">if</span> <span class="ow">not</span> <span class="n">qs</span><span class="p">:</span>
</span><span id="line-804">        <span class="k">return</span> <span class="p">[]</span>
</span><span id="line-805">
</span><span id="line-806">    <span class="c1"># If max_num_fields is defined then check that the number of fields</span>
</span><span id="line-807">    <span class="c1"># is less than max_num_fields. This prevents a memory exhaustion DOS</span>
</span><span id="line-808">    <span class="c1"># attack via post bodies with many fields.</span>
</span><span id="line-809">    <span class="k">if</span> <span class="n">max_num_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-810">        <span class="n">num_fields</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">qs</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
</span><span id="line-811">        <span class="k">if</span> <span class="n">max_num_fields</span> <span class="o">&lt;</span> <span class="n">num_fields</span><span class="p">:</span>
</span><span id="line-812">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Max number of fields exceeded&#39;</span><span class="p">)</span>
</span><span id="line-813">
</span><span id="line-814">    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-815">    <span class="k">for</span> <span class="n">name_value</span> <span class="ow">in</span> <span class="n">qs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">):</span>
</span><span id="line-816">        <span class="k">if</span> <span class="n">name_value</span> <span class="ow">or</span> <span class="n">strict_parsing</span><span class="p">:</span>
</span><span id="line-817">            <span class="n">name</span><span class="p">,</span> <span class="n">has_eq</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">name_value</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
</span><span id="line-818">            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_eq</span> <span class="ow">and</span> <span class="n">strict_parsing</span><span class="p">:</span>
</span><span id="line-819">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bad query field: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_value</span><span class="p">,))</span>
</span><span id="line-820">            <span class="k">if</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">keep_blank_values</span><span class="p">:</span>
</span><span id="line-821">                <span class="n">name</span> <span class="o">=</span> <span class="n">_unquote</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="line-822">                <span class="n">value</span> <span class="o">=</span> <span class="n">_unquote</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="line-823">                <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span><span id="line-824">    <span class="k">return</span> <span class="n">r</span></div>

</span><span id="line-825">
<div class="viewcode-block" id="unquote_plus">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.unquote_plus">[docs]</a>
</span><span id="line-826"><span class="k">def</span><span class="w"> </span><span class="nf">unquote_plus</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">):</span>
</span><span id="line-827"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Like unquote(), but also replace plus signs by spaces, as required for</span>
</span><span id="line-828"><span class="sd">    unquoting HTML form values.</span>
</span><span id="line-829">
</span><span id="line-830"><span class="sd">    unquote_plus(&#39;%7e/abc+def&#39;) -&gt; &#39;~/abc def&#39;</span>
</span><span id="line-831"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-832">    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="line-833">    <span class="k">return</span> <span class="n">unquote</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span></div>

</span><span id="line-834">
</span><span id="line-835"><span class="n">_ALWAYS_SAFE</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
</span><span id="line-836">                         <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
</span><span id="line-837">                         <span class="sa">b</span><span class="s1">&#39;0123456789&#39;</span>
</span><span id="line-838">                         <span class="sa">b</span><span class="s1">&#39;_.-~&#39;</span><span class="p">)</span>
</span><span id="line-839"><span class="n">_ALWAYS_SAFE_BYTES</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">_ALWAYS_SAFE</span><span class="p">)</span>
</span><span id="line-840">
</span><span id="line-841"><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="line-842">    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Quoter&#39;</span><span class="p">:</span>
</span><span id="line-843">        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Deprecated in 3.11. &#39;</span>
</span><span id="line-844">                      <span class="s1">&#39;urllib.parse.Quoter will be removed in Python 3.14. &#39;</span>
</span><span id="line-845">                      <span class="s1">&#39;It was not intended to be a public API.&#39;</span><span class="p">,</span>
</span><span id="line-846">                      <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-847">        <span class="k">return</span> <span class="n">_Quoter</span>
</span><span id="line-848">    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;module </span><span class="si">{</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s1"> has no attribute </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="line-849">
</span><span id="line-850"><span class="k">class</span><span class="w"> </span><span class="nc">_Quoter</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="line-851"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A mapping from bytes numbers (in range(0,256)) to strings.</span>
</span><span id="line-852">
</span><span id="line-853"><span class="sd">    String values are percent-encoded byte values, unless the key &lt; 128, and</span>
</span><span id="line-854"><span class="sd">    in either of the specified safe set, or the always safe set.</span>
</span><span id="line-855"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-856">    <span class="c1"># Keeps a cache internally, via __missing__, for efficiency (lookups</span>
</span><span id="line-857">    <span class="c1"># of cached keys don&#39;t call Python code at all).</span>
</span><span id="line-858">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe</span><span class="p">):</span>
</span><span id="line-859"><span class="w">        </span><span class="sd">&quot;&quot;&quot;safe: bytes object.&quot;&quot;&quot;</span>
</span><span id="line-860">        <span class="bp">self</span><span class="o">.</span><span class="n">safe</span> <span class="o">=</span> <span class="n">_ALWAYS_SAFE</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">safe</span><span class="p">)</span>
</span><span id="line-861">
</span><span id="line-862">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-863">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Quoter </span><span class="si">{</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">&gt;&quot;</span>
</span><span id="line-864">
</span><span id="line-865">    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="line-866">        <span class="c1"># Handle a cache miss. Store quoted string in cache and return.</span>
</span><span id="line-867">        <span class="n">res</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">safe</span> <span class="k">else</span> <span class="s1">&#39;%</span><span class="si">{:02X}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="line-868">        <span class="bp">self</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
</span><span id="line-869">        <span class="k">return</span> <span class="n">res</span>
</span><span id="line-870">
<div class="viewcode-block" id="quote">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.quote">[docs]</a>
</span><span id="line-871"><span class="k">def</span><span class="w"> </span><span class="nf">quote</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="line-872"><span class="w">    </span><span class="sd">&quot;&quot;&quot;quote(&#39;abc def&#39;) -&gt; &#39;abc%20def&#39;</span>
</span><span id="line-873">
</span><span id="line-874"><span class="sd">    Each part of a URL, e.g. the path info, the query, etc., has a</span>
</span><span id="line-875"><span class="sd">    different set of reserved characters that must be quoted. The</span>
</span><span id="line-876"><span class="sd">    quote function offers a cautious (not minimal) way to quote a</span>
</span><span id="line-877"><span class="sd">    string for most of these parts.</span>
</span><span id="line-878">
</span><span id="line-879"><span class="sd">    RFC 3986 Uniform Resource Identifier (URI): Generic Syntax lists</span>
</span><span id="line-880"><span class="sd">    the following (un)reserved characters.</span>
</span><span id="line-881">
</span><span id="line-882"><span class="sd">    unreserved    = ALPHA / DIGIT / &quot;-&quot; / &quot;.&quot; / &quot;_&quot; / &quot;~&quot;</span>
</span><span id="line-883"><span class="sd">    reserved      = gen-delims / sub-delims</span>
</span><span id="line-884"><span class="sd">    gen-delims    = &quot;:&quot; / &quot;/&quot; / &quot;?&quot; / &quot;#&quot; / &quot;[&quot; / &quot;]&quot; / &quot;@&quot;</span>
</span><span id="line-885"><span class="sd">    sub-delims    = &quot;!&quot; / &quot;$&quot; / &quot;&amp;&quot; / &quot;&#39;&quot; / &quot;(&quot; / &quot;)&quot;</span>
</span><span id="line-886"><span class="sd">                  / &quot;*&quot; / &quot;+&quot; / &quot;,&quot; / &quot;;&quot; / &quot;=&quot;</span>
</span><span id="line-887">
</span><span id="line-888"><span class="sd">    Each of the reserved characters is reserved in some component of a URL,</span>
</span><span id="line-889"><span class="sd">    but not necessarily in all of them.</span>
</span><span id="line-890">
</span><span id="line-891"><span class="sd">    The quote function %-escapes all characters that are neither in the</span>
</span><span id="line-892"><span class="sd">    unreserved chars (&quot;always safe&quot;) nor the additional chars set via the</span>
</span><span id="line-893"><span class="sd">    safe arg.</span>
</span><span id="line-894">
</span><span id="line-895"><span class="sd">    The default for the safe arg is &#39;/&#39;. The character is reserved, but in</span>
</span><span id="line-896"><span class="sd">    typical usage the quote function is being called on a path where the</span>
</span><span id="line-897"><span class="sd">    existing slash characters are to be preserved.</span>
</span><span id="line-898">
</span><span id="line-899"><span class="sd">    Python 3.7 updates from using RFC 2396 to RFC 3986 to quote URL strings.</span>
</span><span id="line-900"><span class="sd">    Now, &quot;~&quot; is included in the set of unreserved characters.</span>
</span><span id="line-901">
</span><span id="line-902"><span class="sd">    string and safe may be either str or bytes objects. encoding and errors</span>
</span><span id="line-903"><span class="sd">    must not be specified if string is a bytes object.</span>
</span><span id="line-904">
</span><span id="line-905"><span class="sd">    The optional encoding and errors parameters specify how to deal with</span>
</span><span id="line-906"><span class="sd">    non-ASCII characters, as accepted by the str.encode method.</span>
</span><span id="line-907"><span class="sd">    By default, encoding=&#39;utf-8&#39; (characters are encoded with UTF-8), and</span>
</span><span id="line-908"><span class="sd">    errors=&#39;strict&#39; (unsupported characters raise a UnicodeEncodeError).</span>
</span><span id="line-909"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-910">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-911">        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="p">:</span>
</span><span id="line-912">            <span class="k">return</span> <span class="n">string</span>
</span><span id="line-913">        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-914">            <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="line-915">        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-916">            <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;strict&#39;</span>
</span><span id="line-917">        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-918">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-919">        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-920">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;quote() doesn&#39;t support &#39;encoding&#39; for bytes&quot;</span><span class="p">)</span>
</span><span id="line-921">        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-922">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;quote() doesn&#39;t support &#39;errors&#39; for bytes&quot;</span><span class="p">)</span>
</span><span id="line-923">    <span class="k">return</span> <span class="n">quote_from_bytes</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span></div>

</span><span id="line-924">
<div class="viewcode-block" id="quote_plus">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.quote_plus">[docs]</a>
</span><span id="line-925"><span class="k">def</span><span class="w"> </span><span class="nf">quote_plus</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="line-926"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Like quote(), but also replace &#39; &#39; with &#39;+&#39;, as required for quoting</span>
</span><span id="line-927"><span class="sd">    HTML form values. Plus signs in the original string are escaped unless</span>
</span><span id="line-928"><span class="sd">    they are included in safe. It also does not have safe default to &#39;/&#39;.</span>
</span><span id="line-929"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-930">    <span class="c1"># Check if &#39; &#39; in string, where string may either be a str or bytes.  If</span>
</span><span id="line-931">    <span class="c1"># there are no spaces, the regular quote will produce the right answer.</span>
</span><span id="line-932">    <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="p">)</span> <span class="ow">or</span>
</span><span id="line-933">        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="p">)):</span>
</span><span id="line-934">        <span class="k">return</span> <span class="n">quote</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-935">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safe</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-936">        <span class="n">space</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
</span><span id="line-937">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-938">        <span class="n">space</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span>
</span><span id="line-939">    <span class="n">string</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span> <span class="o">+</span> <span class="n">space</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-940">    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span></div>

</span><span id="line-941">
</span><span id="line-942"><span class="c1"># Expectation: A typical program is unlikely to create more than 5 of these.</span>
</span><span id="line-943"><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span>
</span><span id="line-944"><span class="k">def</span><span class="w"> </span><span class="nf">_byte_quoter_factory</span><span class="p">(</span><span class="n">safe</span><span class="p">):</span>
</span><span id="line-945">    <span class="k">return</span> <span class="n">_Quoter</span><span class="p">(</span><span class="n">safe</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span>
</span><span id="line-946">
<div class="viewcode-block" id="quote_from_bytes">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.quote_from_bytes">[docs]</a>
</span><span id="line-947"><span class="k">def</span><span class="w"> </span><span class="nf">quote_from_bytes</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
</span><span id="line-948"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Like quote(), but accepts a bytes object rather than a str, and does</span>
</span><span id="line-949"><span class="sd">    not perform string-to-bytes encoding.  It always returns an ASCII string.</span>
</span><span id="line-950"><span class="sd">    quote_from_bytes(b&#39;abc def\x3f&#39;) -&gt; &#39;abc%20def%3f&#39;</span>
</span><span id="line-951"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-952">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
</span><span id="line-953">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;quote_from_bytes() expected bytes&quot;</span><span class="p">)</span>
</span><span id="line-954">    <span class="k">if</span> <span class="ow">not</span> <span class="n">bs</span><span class="p">:</span>
</span><span id="line-955">        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-956">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safe</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-957">        <span class="c1"># Normalize &#39;safe&#39; by converting to bytes and removing non-ASCII chars</span>
</span><span id="line-958">        <span class="n">safe</span> <span class="o">=</span> <span class="n">safe</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span><span id="line-959">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-960">        <span class="c1"># List comprehensions are faster than generator expressions.</span>
</span><span id="line-961">        <span class="n">safe</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">safe</span> <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">])</span>
</span><span id="line-962">    <span class="k">if</span> <span class="ow">not</span> <span class="n">bs</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">_ALWAYS_SAFE_BYTES</span> <span class="o">+</span> <span class="n">safe</span><span class="p">):</span>
</span><span id="line-963">        <span class="k">return</span> <span class="n">bs</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="line-964">    <span class="n">quoter</span> <span class="o">=</span> <span class="n">_byte_quoter_factory</span><span class="p">(</span><span class="n">safe</span><span class="p">)</span>
</span><span id="line-965">    <span class="k">if</span> <span class="p">(</span><span class="n">bs_len</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">200_000</span><span class="p">:</span>
</span><span id="line-966">        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">quoter</span><span class="p">,</span> <span class="n">bs</span><span class="p">))</span>
</span><span id="line-967">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-968">        <span class="c1"># This saves memory - https://github.com/python/cpython/issues/95865</span>
</span><span id="line-969">        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">isqrt</span><span class="p">(</span><span class="n">bs_len</span><span class="p">)</span>
</span><span id="line-970">        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">quoter</span><span class="p">,</span> <span class="n">bs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk_size</span><span class="p">]))</span>
</span><span id="line-971">                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bs_len</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)]</span>
</span><span id="line-972">        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span></div>

</span><span id="line-973">
<div class="viewcode-block" id="urlencode">
<a class="viewcode-back" href="../../../kitchen-sink/api/#urllib.parse.urlencode">[docs]</a>
</span><span id="line-974"><span class="k">def</span><span class="w"> </span><span class="nf">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="line-975">              <span class="n">quote_via</span><span class="o">=</span><span class="n">quote_plus</span><span class="p">):</span>
</span><span id="line-976"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a dict or sequence of two-element tuples into a URL query string.</span>
</span><span id="line-977">
</span><span id="line-978"><span class="sd">    If any values in the query arg are sequences and doseq is true, each</span>
</span><span id="line-979"><span class="sd">    sequence element is converted to a separate parameter.</span>
</span><span id="line-980">
</span><span id="line-981"><span class="sd">    If the query arg is a sequence of two-element tuples, the order of the</span>
</span><span id="line-982"><span class="sd">    parameters in the output will match the order of parameters in the</span>
</span><span id="line-983"><span class="sd">    input.</span>
</span><span id="line-984">
</span><span id="line-985"><span class="sd">    The components of a query arg may each be either a string or a bytes type.</span>
</span><span id="line-986">
</span><span id="line-987"><span class="sd">    The safe, encoding, and errors parameters are passed down to the function</span>
</span><span id="line-988"><span class="sd">    specified by quote_via (encoding and errors only if a component is a str).</span>
</span><span id="line-989"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-990">
</span><span id="line-991">    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">):</span>
</span><span id="line-992">        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="line-993">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-994">        <span class="c1"># It&#39;s a bother at times that strings and string-like objects are</span>
</span><span id="line-995">        <span class="c1"># sequences.</span>
</span><span id="line-996">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-997">            <span class="c1"># non-sequence items should not work with len()</span>
</span><span id="line-998">            <span class="c1"># non-empty strings will fail this</span>
</span><span id="line-999">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="line-1000">                <span class="k">raise</span> <span class="ne">TypeError</span>
</span><span id="line-1001">            <span class="c1"># Zero-length sequences of all types will get here and succeed,</span>
</span><span id="line-1002">            <span class="c1"># but that&#39;s a minor nit.  Since the original implementation</span>
</span><span id="line-1003">            <span class="c1"># allowed empty dicts that type of behavior probably should be</span>
</span><span id="line-1004">            <span class="c1"># preserved for consistency</span>
</span><span id="line-1005">        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="line-1006">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not a valid non-string sequence &quot;</span>
</span><span id="line-1007">                            <span class="s2">&quot;or mapping object&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</span><span id="line-1008">
</span><span id="line-1009">    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-1010">    <span class="k">if</span> <span class="ow">not</span> <span class="n">doseq</span><span class="p">:</span>
</span><span id="line-1011">        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
</span><span id="line-1012">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-1013">                <span class="n">k</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>
</span><span id="line-1014">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-1015">                <span class="n">k</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1016">
</span><span id="line-1017">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-1018">                <span class="n">v</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>
</span><span id="line-1019">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-1020">                <span class="n">v</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1021">            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
</span><span id="line-1022">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-1023">        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
</span><span id="line-1024">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-1025">                <span class="n">k</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>
</span><span id="line-1026">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-1027">                <span class="n">k</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1028">
</span><span id="line-1029">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-1030">                <span class="n">v</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>
</span><span id="line-1031">                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
</span><span id="line-1032">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-1033">                <span class="n">v</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1034">                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
</span><span id="line-1035">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-1036">                <span class="k">try</span><span class="p">:</span>
</span><span id="line-1037">                    <span class="c1"># Is this a sufficient test for sequence-ness?</span>
</span><span id="line-1038">                    <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="line-1039">                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="line-1040">                    <span class="c1"># not a sequence</span>
</span><span id="line-1041">                    <span class="n">v</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1042">                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
</span><span id="line-1043">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-1044">                    <span class="c1"># loop over the sequence</span>
</span><span id="line-1045">                    <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
</span><span id="line-1046">                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="line-1047">                            <span class="n">elt</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>
</span><span id="line-1048">                        <span class="k">else</span><span class="p">:</span>
</span><span id="line-1049">                            <span class="n">elt</span> <span class="o">=</span> <span class="n">quote_via</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="p">),</span> <span class="n">safe</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span id="line-1050">                        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">elt</span><span class="p">)</span>
</span><span id="line-1051">    <span class="k">return</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>

</span><span id="line-1052">
</span><span id="line-1053">
</span><span id="line-1054"><span class="k">def</span><span class="w"> </span><span class="nf">to_bytes</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1055">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.to_bytes() is deprecated as of 3.8&quot;</span><span class="p">,</span>
</span><span id="line-1056">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1057">    <span class="k">return</span> <span class="n">_to_bytes</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1058">
</span><span id="line-1059">
</span><span id="line-1060"><span class="k">def</span><span class="w"> </span><span class="nf">_to_bytes</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1061"><span class="w">    </span><span class="sd">&quot;&quot;&quot;to_bytes(u&quot;URL&quot;) --&gt; &#39;URL&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1062">    <span class="c1"># Most URL schemes require ASCII. If that changes, the conversion</span>
</span><span id="line-1063">    <span class="c1"># can be relaxed.</span>
</span><span id="line-1064">    <span class="c1"># XXX get rid of to_bytes()</span>
</span><span id="line-1065">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-1066">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-1067">            <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ASCII&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="line-1068">        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
</span><span id="line-1069">            <span class="k">raise</span> <span class="ne">UnicodeError</span><span class="p">(</span><span class="s2">&quot;URL &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">+</span>
</span><span id="line-1070">                               <span class="s2">&quot; contains non-ASCII characters&quot;</span><span class="p">)</span>
</span><span id="line-1071">    <span class="k">return</span> <span class="n">url</span>
</span><span id="line-1072">
</span><span id="line-1073">
</span><span id="line-1074"><span class="k">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1075"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform a string like &#39;&lt;URL:scheme://host/path&gt;&#39; into &#39;scheme://host/path&#39;.</span>
</span><span id="line-1076">
</span><span id="line-1077"><span class="sd">    The string is returned unchanged if it&#39;s not a wrapped URL.</span>
</span><span id="line-1078"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-1079">    <span class="n">url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="line-1080">    <span class="k">if</span> <span class="n">url</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="n">url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="line-1081">        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="line-1082">    <span class="k">if</span> <span class="n">url</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;URL:&#39;</span><span class="p">:</span>
</span><span id="line-1083">        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="line-1084">    <span class="k">return</span> <span class="n">url</span>
</span><span id="line-1085">
</span><span id="line-1086">
</span><span id="line-1087"><span class="k">def</span><span class="w"> </span><span class="nf">splittype</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1088">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splittype() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1089">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1090">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1091">    <span class="k">return</span> <span class="n">_splittype</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1092">
</span><span id="line-1093">
</span><span id="line-1094"><span class="n">_typeprog</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-1095"><span class="k">def</span><span class="w"> </span><span class="nf">_splittype</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1096"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splittype(&#39;type:opaquestring&#39;) --&gt; &#39;type&#39;, &#39;opaquestring&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1097">    <span class="k">global</span> <span class="n">_typeprog</span>
</span><span id="line-1098">    <span class="k">if</span> <span class="n">_typeprog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1099">        <span class="n">_typeprog</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;([^/:]+):(.*)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</span><span id="line-1100">
</span><span id="line-1101">    <span class="n">match</span> <span class="o">=</span> <span class="n">_typeprog</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1102">    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="line-1103">        <span class="n">scheme</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="line-1104">        <span class="k">return</span> <span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">data</span>
</span><span id="line-1105">    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">url</span>
</span><span id="line-1106">
</span><span id="line-1107">
</span><span id="line-1108"><span class="k">def</span><span class="w"> </span><span class="nf">splithost</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1109">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splithost() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1110">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1111">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1112">    <span class="k">return</span> <span class="n">_splithost</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1113">
</span><span id="line-1114">
</span><span id="line-1115"><span class="n">_hostprog</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-1116"><span class="k">def</span><span class="w"> </span><span class="nf">_splithost</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1117"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splithost(&#39;//host[:port]/path&#39;) --&gt; &#39;host[:port]&#39;, &#39;/path&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1118">    <span class="k">global</span> <span class="n">_hostprog</span>
</span><span id="line-1119">    <span class="k">if</span> <span class="n">_hostprog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1120">        <span class="n">_hostprog</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;//([^/#?]*)(.*)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</span><span id="line-1121">
</span><span id="line-1122">    <span class="n">match</span> <span class="o">=</span> <span class="n">_hostprog</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1123">    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="line-1124">        <span class="n">host_port</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="line-1125">        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="line-1126">            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="line-1127">        <span class="k">return</span> <span class="n">host_port</span><span class="p">,</span> <span class="n">path</span>
</span><span id="line-1128">    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">url</span>
</span><span id="line-1129">
</span><span id="line-1130">
</span><span id="line-1131"><span class="k">def</span><span class="w"> </span><span class="nf">splituser</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
</span><span id="line-1132">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splituser() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1133">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1134">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1135">    <span class="k">return</span> <span class="n">_splituser</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span id="line-1136">
</span><span id="line-1137">
</span><span id="line-1138"><span class="k">def</span><span class="w"> </span><span class="nf">_splituser</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
</span><span id="line-1139"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splituser(&#39;user[:passwd]@host[:port]&#39;) --&gt; &#39;user[:passwd]&#39;, &#39;host[:port]&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1140">    <span class="n">user</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
</span><span id="line-1141">    <span class="k">return</span> <span class="p">(</span><span class="n">user</span> <span class="k">if</span> <span class="n">delim</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span> <span class="n">host</span>
</span><span id="line-1142">
</span><span id="line-1143">
</span><span id="line-1144"><span class="k">def</span><span class="w"> </span><span class="nf">splitpasswd</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
</span><span id="line-1145">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitpasswd() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1146">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1147">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1148">    <span class="k">return</span> <span class="n">_splitpasswd</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span id="line-1149">
</span><span id="line-1150">
</span><span id="line-1151"><span class="k">def</span><span class="w"> </span><span class="nf">_splitpasswd</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
</span><span id="line-1152"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splitpasswd(&#39;user:passwd&#39;) -&gt; &#39;user&#39;, &#39;passwd&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1153">    <span class="n">user</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">passwd</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-1154">    <span class="k">return</span> <span class="n">user</span><span class="p">,</span> <span class="p">(</span><span class="n">passwd</span> <span class="k">if</span> <span class="n">delim</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="line-1155">
</span><span id="line-1156">
</span><span id="line-1157"><span class="k">def</span><span class="w"> </span><span class="nf">splitport</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
</span><span id="line-1158">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitport() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1159">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1160">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1161">    <span class="k">return</span> <span class="n">_splitport</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span id="line-1162">
</span><span id="line-1163">
</span><span id="line-1164"><span class="c1"># splittag(&#39;/path#tag&#39;) --&gt; &#39;/path&#39;, &#39;tag&#39;</span>
</span><span id="line-1165"><span class="n">_portprog</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-1166"><span class="k">def</span><span class="w"> </span><span class="nf">_splitport</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
</span><span id="line-1167"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splitport(&#39;host:port&#39;) --&gt; &#39;host&#39;, &#39;port&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1168">    <span class="k">global</span> <span class="n">_portprog</span>
</span><span id="line-1169">    <span class="k">if</span> <span class="n">_portprog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1170">        <span class="n">_portprog</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(.*):([0-9]*)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</span><span id="line-1171">
</span><span id="line-1172">    <span class="n">match</span> <span class="o">=</span> <span class="n">_portprog</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span id="line-1173">    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="line-1174">        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="line-1175">        <span class="k">if</span> <span class="n">port</span><span class="p">:</span>
</span><span id="line-1176">            <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span>
</span><span id="line-1177">    <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="line-1178">
</span><span id="line-1179">
</span><span id="line-1180"><span class="k">def</span><span class="w"> </span><span class="nf">splitnport</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">defport</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="line-1181">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitnport() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1182">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1183">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1184">    <span class="k">return</span> <span class="n">_splitnport</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">defport</span><span class="p">)</span>
</span><span id="line-1185">
</span><span id="line-1186">
</span><span id="line-1187"><span class="k">def</span><span class="w"> </span><span class="nf">_splitnport</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">defport</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="line-1188"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Split host and port, returning numeric port.</span>
</span><span id="line-1189"><span class="sd">    Return given default port if no &#39;:&#39; found; defaults to -1.</span>
</span><span id="line-1190"><span class="sd">    Return numerical port if a valid number is found after &#39;:&#39;.</span>
</span><span id="line-1191"><span class="sd">    Return None if &#39;:&#39; but not a valid number.&quot;&quot;&quot;</span>
</span><span id="line-1192">    <span class="n">host</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="line-1193">    <span class="k">if</span> <span class="ow">not</span> <span class="n">delim</span><span class="p">:</span>
</span><span id="line-1194">        <span class="n">host</span> <span class="o">=</span> <span class="n">port</span>
</span><span id="line-1195">    <span class="k">elif</span> <span class="n">port</span><span class="p">:</span>
</span><span id="line-1196">        <span class="k">if</span> <span class="n">port</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">port</span><span class="o">.</span><span class="n">isascii</span><span class="p">():</span>
</span><span id="line-1197">            <span class="n">nport</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</span><span id="line-1198">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-1199">            <span class="n">nport</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="line-1200">        <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="n">nport</span>
</span><span id="line-1201">    <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="n">defport</span>
</span><span id="line-1202">
</span><span id="line-1203">
</span><span id="line-1204"><span class="k">def</span><span class="w"> </span><span class="nf">splitquery</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1205">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitquery() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1206">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1207">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1208">    <span class="k">return</span> <span class="n">_splitquery</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1209">
</span><span id="line-1210">
</span><span id="line-1211"><span class="k">def</span><span class="w"> </span><span class="nf">_splitquery</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1212"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splitquery(&#39;/path?query&#39;) --&gt; &#39;/path&#39;, &#39;query&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1213">    <span class="n">path</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
</span><span id="line-1214">    <span class="k">if</span> <span class="n">delim</span><span class="p">:</span>
</span><span id="line-1215">        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">query</span>
</span><span id="line-1216">    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="line-1217">
</span><span id="line-1218">
</span><span id="line-1219"><span class="k">def</span><span class="w"> </span><span class="nf">splittag</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1220">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splittag() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1221">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1222">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1223">    <span class="k">return</span> <span class="n">_splittag</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1224">
</span><span id="line-1225">
</span><span id="line-1226"><span class="k">def</span><span class="w"> </span><span class="nf">_splittag</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1227"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splittag(&#39;/path#tag&#39;) --&gt; &#39;/path&#39;, &#39;tag&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1228">    <span class="n">path</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
</span><span id="line-1229">    <span class="k">if</span> <span class="n">delim</span><span class="p">:</span>
</span><span id="line-1230">        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">tag</span>
</span><span id="line-1231">    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="line-1232">
</span><span id="line-1233">
</span><span id="line-1234"><span class="k">def</span><span class="w"> </span><span class="nf">splitattr</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1235">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitattr() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1236">                  <span class="s2">&quot;use urllib.parse.urlparse() instead&quot;</span><span class="p">,</span>
</span><span id="line-1237">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1238">    <span class="k">return</span> <span class="n">_splitattr</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="line-1239">
</span><span id="line-1240">
</span><span id="line-1241"><span class="k">def</span><span class="w"> </span><span class="nf">_splitattr</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="line-1242"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splitattr(&#39;/path;attr1=value1;attr2=value2;...&#39;) -&gt;</span>
</span><span id="line-1243"><span class="sd">        &#39;/path&#39;, [&#39;attr1=value1&#39;, &#39;attr2=value2&#39;, ...].&quot;&quot;&quot;</span>
</span><span id="line-1244">    <span class="n">words</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span><span id="line-1245">    <span class="k">return</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="line-1246">
</span><span id="line-1247">
</span><span id="line-1248"><span class="k">def</span><span class="w"> </span><span class="nf">splitvalue</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
</span><span id="line-1249">    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;urllib.parse.splitvalue() is deprecated as of 3.8, &quot;</span>
</span><span id="line-1250">                  <span class="s2">&quot;use urllib.parse.parse_qsl() instead&quot;</span><span class="p">,</span>
</span><span id="line-1251">                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1252">    <span class="k">return</span> <span class="n">_splitvalue</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="line-1253">
</span><span id="line-1254">
</span><span id="line-1255"><span class="k">def</span><span class="w"> </span><span class="nf">_splitvalue</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
</span><span id="line-1256"><span class="w">    </span><span class="sd">&quot;&quot;&quot;splitvalue(&#39;attr=value&#39;) --&gt; &#39;attr&#39;, &#39;value&#39;.&quot;&quot;&quot;</span>
</span><span id="line-1257">    <span class="n">attr</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span><span id="line-1258">    <span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="k">if</span> <span class="n">delim</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span></code></pre></div>
    </div></div>
        </main>
      </div>
    </div><footer class="py-6 border-t border-border md:py-0">
    <div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
      <div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
        <p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2021, Pradyun Gedam&nbsp;Built with <a class="font-medium underline underline-offset-4"
    href="https://www.sphinx-doc.org"
    rel="noreferrer">Sphinx 8.2.3</a></p>
</div>
</div>
</footer>
  </div>
  
    <script src="../../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script defer="defer" src="../../../_static/theme.js?v=073f68d9"></script>
  
</body>
</html>